# ADR-001: Стандартизированный формат ошибок (RFC 7807)
Дата: 2025-10-26
Статус: Accepted

## Context
Ранее ошибки возвращались в произвольном формате, что усложняло обработку на фронтенде и мешало трассировке (нет уникальных ID, разные поля).
Необходимо унифицировать формат ошибок и маскировать внутренние детали (SQL, стеки).

## Decision
Введён единый доменный класс `ApiError`, совместимый с RFC 7807.
Ошибки сериализуются в JSON со структурой:
`{type, title, status, detail, correlation_id}`.
Для внутренних ошибок `detail` маскируется, а `correlation_id` логируется на сервере.
Ошибки Pydantic также конвертируются через общий обработчик.

## Consequences
- Упрощена отладка и трассировка
- Соответствие NFR по безопасности (маскирование деталей)
- Небольшое увеличение накладных расходов на формирование структуры ответа

## Links
- NFR-03 (Ошибки RFC7807)
- F6, R2 из Threat Model (утечка ошибок)
- tests/test_errors.py::test_rfc7807_contract
